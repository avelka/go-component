import{r as t,c as i,h as e,g as r}from"./p-41f4975c.js";var s,a=(function(t){var i,e,r,s,a,n,o,c,d,h,l,g,u,y,M,m,I,b,f,x,j,p,w,v,A,D;(D={}).Util=i={isNumber:function(t){return"number"==typeof t&&isFinite(t)},isInteger:function(t){return i.isNumber(t)&&Math.floor(t)===t}},D.parse=(a=/^\s*/g,n=/^\(\s*/g,o=/^\)\s*/g,c=/^;\s*/g,d=/^([a-zA-Z0-9]+)\s*/g,h=/^\[((?:\\[\S\s]|[^\]\\]+)*)\]\s*/g,l=function(){var t=this.test(e.slice(r));return r+=this.lastIndex,this.lastIndex=0,t},g=function(){var t=this.exec(e.slice(r));return r+=this.lastIndex,this.lastIndex=0,t},u=function(t){var i=[];if(l.call(n)){for(;l.call(c);){for(var s={};;){var a=g.call(d);if(!a)break;if(s.hasOwnProperty(a=a[1]))throw new SyntaxError("Property "+a+" already exists");for(var m=[];;){var I=g.call(h);if(!I)break;m.push(I[1])}if(!m.length)throw new SyntaxError("PropValue of "+a+" is missing");s[a]=m}t=t||y(s),s=M(s,t),i.push(s)}if(!i.length)throw new SyntaxError("GameTree does not contain any Nodes");for(var b=[];;){var f=u(t);if(!f)break;b.push(f)}if(!l.call(o))throw new SyntaxError("Unexpected token "+e.charAt(r));return 1===b.length&&(i=i.concat(b[0][0]),b=b[0][1]),[i,b]}},y=function(t){var i=D.fileFormat({FF:4}).Types.Number;return D.fileFormat({FF:i.parse(t.FF||[])||1,GM:i.parse(t.GM||[])||1}).properties()},M=function(t,i){var e={};for(var r in t)if(t.hasOwnProperty(r)){var s=i.parse(r,t[r]);if(!s)throw new SyntaxError("Invalid PropIdent "+r);if(e.hasOwnProperty(s[0]))throw new SyntaxError("Property "+s[0]+" already exists");if(void 0===s[1]){var a=r+"["+t[r].join("][")+"]";throw new SyntaxError("Invalid PropValue "+a)}e[s[0]]=s[1]}return e},m=function(t,i){var e=t[i];if(e&&"object"==typeof e)for(var r in e)if(e.hasOwnProperty(r)){var a=m(e,r);void 0!==a?e[r]=a:delete e[r]}return s.call(t,i,e)},function(t,i){var n=[];for(e=String(t),r=0,s="function"==typeof i&&i,l.call(a);;){var o=u();if(!o)break;n.push(o)}if(r!==e.length)throw new SyntaxError("Unexpected token "+e.charAt(r));return s?m({"":n},""):n}),D.stringify=(j=Array.isArray,p=function(t,i){var e,r,s,a=i[t];if(a&&"object"==typeof a&&"function"==typeof a.toSGF&&(a=a.toSGF(t)),I&&(a=I.call(i,t,a)),a&&"object"==typeof a)if(j(a))for(s=[],e=0;e<a.length;e++)s[e]=p(e,a);else if(s={},b)for(e=0;e<b.length;e++)s[b[e]]=p(b[e],a);else for(r in a)a.hasOwnProperty(r)&&(s[r]=p(r,a));else s=a;return s},w=function(t,i){t=j(t)?t:[];var e=j(t[0])?t[0]:[],r=j(t[1])?t[1]:[];1===r.length&&(e=e.concat(j(r[0][0])?r[0][0]:[]),r=j(r[0][1])?r[0][1]:[]);var s,a="",n=f?"\n":"",o=x;if(e.length){a+=x+"("+n;for(var c=(x+=f)+";",d=x+(f?" ":""),h=0;h<e.length;h++){var l=e[h]&&"object"==typeof e[h]?e[h]:{},g=[];for(var u in i=i||D.fileFormat({FF:(s=l).hasOwnProperty("FF")?s.FF:1,GM:s.hasOwnProperty("GM")?s.GM:1}).properties(),l)if(l.hasOwnProperty(u)){var y=i.stringify(u,l[u]);y&&g.push(u+"["+y.join("][")+"]")}a+=c+g.join(n+d)+n}for(var M=0;M<r.length;M++)a+=w(r[M],i);a+=o+")"+n,x=o}return a},function(t,i,e){var r,s;if(I=null,b=null,f="",x="",j(i))for(b=[],s=0;s<i.length;s++)"string"==typeof i[s]&&b.push(i[s]);else if("function"==typeof i)I=i;else if(i)throw new Error("replacer must be array or function");if("number"==typeof e)for(s=0;s<e;s++)f+=" ";else"string"==typeof e&&(f=e);if(t=p("",{"":t}),j(t))for(r="",s=0;s<t.length;s++)r+=w(t[s]);return r}),D.fileFormat=(v=D.Util.isInteger,A={},function(t,i){var e=(t=t||{}).FF,r=t.GM;if("function"!=typeof i)return v(e)&&e>0&&A[e]?v(r)&&r>0&&A[e].GM[r]?A[e].GM[r]:A[e]:A;var s={};s=i.call(s,A)||s,e&&r?A[e].GM[r]=s:e?(s.GM=s.GM||{},A[e]=s):A=s}),D.fileFormat({},(function(){var t={scalar:function(t){var i={},e=(t=t||{}).like||{test:function(){return!0}},r=t.parse||function(t){return t},s=t.isa||function(t){return"string"==typeof t&&e.test(t)},a=t.stringify||String;return i.parse=function(t){if(1===t.length&&e.test(t[0]))return r(t[0])},i.stringify=function(t){if(s(t))return[a(t)]},i}};t.Unknown={parse:function(t){for(var i=[],e=0;e<t.length;e++)i[e]=t[e].replace(/\\\]/g,"]");return i},stringify:function(t){if(Array.isArray(t)){for(var i=[],e=0;e<t.length;e++){if("string"!=typeof t[e])return;i[e]=t[e].replace(/\]/g,"\\]")}return i}}},this.Types=t,this.properties=function(i,e){return i=i||t,{typeOf:(e=e||{}).typeOf||{},defaultType:e.defaultType||i.Unknown,identifiers:e.identifiers||{test:function(){return!1}},replacer:e.replacer,merge:function(t){for(var i in t)t.hasOwnProperty(i)&&t[i]&&(this.typeOf[i]=t[i]);return this},parse:function(t,i){if(this.replacer&&(t=this.replacer.call(null,t)),this.identifiers.test(t))return[t,(this.typeOf[t]||this.defaultType).parse(i)]},stringify:function(t,i){if(this.identifiers.test(t))return(this.typeOf[t]||this.defaultType).stringify(i)}}}})),D.fileFormat({FF:4},(function(t){var i=Object.create(t.Types),e=Array.isArray;i.compose=function(t,i){return t&&i&&{escape:function(t){return t.replace(/:/g,"\\:")},parse:function(e){if(1===e.length){var r=/^((?:\\[\S\s]|[^:\\]+)*):((?:\\[\S\s]|[^:\\]+)*)$/.exec(e[0])||void 0,s=r&&t.parse([r[1]]),a=r&&i.parse([r[2]]);if(void 0!==s&&void 0!==a)return[s,a]}},stringify:function(r){if(e(r)&&2===r.length){var s=t.stringify(r[0]),a=i.stringify(r[1]);return s&&a&&[this.escape(s[0])+":"+this.escape(a[0])]}}}},i.listOf=function(t,i){return i=i||{},t&&{canBeEmpty:i.canBeEmpty,parse:function(i){var e=[];if(1===i.length&&""===i[0])return this.canBeEmpty?e:void 0;for(var r=0;r<i.length;r++)if(e[r]=t.parse([i[r]]),void 0===e[r])return;return e},stringify:function(i){if(e(i)){if(!i.length)return this.canBeEmpty?[""]:void 0;for(var r=[],s=0;s<i.length;s++)if(r[s]=t.stringify(i[s])[0],void 0===r[s])return;return r}},toElist:function(){var t=Object.create(this);return t.canBeEmpty=!0,t}}},i.elistOf=function(t){return i.listOf(t,{canBeEmpty:!0})},i.or=function(t,i){return t&&i&&{parse:function(e){var r=t.parse(e);return void 0!==r?r:i.parse(e)},stringify:function(e){return t.stringify(e)||i.stringify(e)}}},i.Number=i.scalar({like:/^[+-]?\d+$/,isa:D.Util.isInteger,parse:function(t){return parseInt(t,10)}}),i.None=i.scalar({like:{test:function(t){return""===t}},isa:function(t){return null===t},parse:function(){return null},stringify:function(){return""}}),i.Real=i.scalar({like:/^[+-]?\d+(?:\.\d+)?$/,isa:D.Util.isNumber,parse:parseFloat}),i.Double=i.scalar({like:/^[12]$/,isa:function(t){return 1===t||2===t},parse:parseInt}),i.Color=i.scalar({like:/^[BW]$/}),i.Text=i.scalar({parse:function(t){return t.replace(/\\(?:\n\r?|\r\n?)/g,"").replace(/[^\S\n\r]/g," ").replace(/\\([\S\s])/g,"$1")},stringify:function(t){return t.replace(/([\]\\])/g,"\\$1")}}),i.SimpleText=i.scalar({parse:function(t){return t.replace(/\\(?:\n\r?|\r\n?)/g,"").replace(/\\?[^\S ]/g," ").replace(/\\([\S\s])/g,"$1")},stringify:function(t){return t.replace(/([\]\\])/g,"\\$1")}}),this.Types=i,this.properties=function(e){return t.properties(e=e||i,{identifiers:/^[A-Z]+$/,typeOf:{B:e.Move,KO:e.None,MN:e.Number,W:e.Move,AB:e.listOfStone||e.listOf(e.Stone),AE:e.listOfPoint,AW:e.listOfStone||e.listOf(e.Stone),PL:e.Color,C:e.Text,DM:e.Double,GB:e.Double,GW:e.Double,HO:e.Double,N:e.SimpleText,UC:e.Double,V:e.Real,BM:e.Double,DO:e.None,IT:e.None,TE:e.Double,AR:e.listOf(e.compose(e.Point,e.Point)),CR:e.listOfPoint,DD:e.elistOfPoint,LB:e.listOf(e.compose(e.Point,e.SimpleText)),LN:e.listOf(e.compose(e.Point,e.Point)),MA:e.listOfPoint,SL:e.listOfPoint,SQ:e.listOfPoint,TR:e.listOfPoint,AP:e.compose(e.SimpleText,e.SimpleText),CA:e.SimpleText,FF:e.Number,GM:e.Number,ST:e.Number,SZ:e.or(e.Number,e.compose(e.Number,e.Number)),AN:e.SimpleText,BR:e.SimpleText,BT:e.SimpleText,CP:e.SimpleText,DT:e.SimpleText,EV:e.SimpleText,GN:e.SimpleText,GC:e.Text,ON:e.SimpleText,OT:e.SimpleText,PB:e.SimpleText,PC:e.SimpleText,PW:e.SimpleText,RE:e.SimpleText,RO:e.SimpleText,RU:e.SimpleText,SO:e.SimpleText,TM:e.Real,US:e.SimpleText,WR:e.SimpleText,WT:e.SimpleText,BL:e.Real,OB:e.Number,OW:e.Number,WL:e.Real,FG:e.or(e.None,e.compose(e.Number,e.SimpleText)),PM:e.Number,VM:e.elistOfPoint}})}})),D.fileFormat({FF:4,GM:1},(function(t){var i,e=Object.create(t[4].Types),r=(i="abcdefghijklmnopqrstuvwxyz",i+=i.toUpperCase(),function(t,e){var r,s=i.indexOf(t.charAt(0)),a=i.indexOf(t.charAt(1)),n=i.indexOf(e.charAt(0)),o=i.indexOf(e.charAt(1));s>n&&(r=s,s=n,n=r),a>o&&(r=a,a=o,o=r);for(var c=[],d=a;d<=o;d++)for(var h=s;h<=n;h++)c.push(i.charAt(h)+i.charAt(d));return c});e.Point=e.scalar({like:/^[a-zA-Z]{2}$/}),e.Stone=e.Point,e.Move=e.or(e.None,e.Point),e.listOfPoint=function(t){var i=t.listOf(t.or(t.Point,t.scalar({like:/^[a-zA-Z]{2}:[a-zA-Z]{2}$/,parse:function(t){var i=t.split(":");return r(i[0],i[1])}}))),e=i.parse,s=[];return i.parse=function(t){var i=e.call(this,t);return i&&s.concat.apply(s,i)},i}(e),e.elistOfPoint=e.listOfPoint.toElist(),e.listOfStone=e.listOfPoint,e.elistOfStone=e.elistOfPoint,this.Types=e,this.properties=function(i){var r=t[4].properties(i=i||e);return r.merge({HA:i.Number,KM:i.Real,TB:i.elistOfPoint,TW:i.elistOfPoint}),r}})),t.exports=D}(s={path:undefined,exports:{},require:function(){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}}),s.exports),n=function(t,i){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&i.indexOf(r)<0&&(e[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(t);s<r.length;s++)i.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(e[r[s]]=t[r[s]])}return e};const o=(t=26)=>new Array(t).fill(1).map(((t,i)=>String.fromCharCode(97+i))),c=t=>o().indexOf(t),d=t=>o()[t],h=(t,i,e)=>Math.min(Math.max(i,t),e),l=(t,i=[],e=0,r=0)=>{const[s,a=[]]=t,n=i&&i[e]||0,o=s.map(((i,s)=>Object.assign(Object.assign({},i),{branchIndex:s,source:{treeRef:t,pos:r,branch:n,level:e,variations:a.length}})));return a.length?[...o,...l(a[n],i,e+1,o.length+1)]:o};function g(t,i=[]){return l(t,i)}const u=(t,i)=>{const e=t.B||t.W?t.B?"black":"white":null;return Object.assign(Object.assign(Object.assign({order:i},t),{comment:t.C,state:e}),(t=>{const i=t.B||t.W;if(i){const[t,e]=i.split("");return{x:c(t),y:c(e)}}return{x:null,y:null}})(t))};function y(t){return t&&t.reduce(((t,i)=>[...t,...i]),[]).filter((t=>t.state||t.label))}function M(t=[],i=[]){return i.reduce(((i,e,r)=>{if(i){const i=t[r];return i?e===i:0===e}return!1}),!0)}function m(t){const i=a.parse(t),[[e]]=i,[r]=e,{PB:s,PW:o,BR:c,WR:d,SZ:h,KM:l,RU:g,GN:u,CP:y,US:M,AN:m,TM:I,OT:b,RE:f,DT:x}=r;return{players:[{color:"BLACK",name:s,level:c},{color:"WHITE",name:o,level:d}],info:{size:h,komi:l,rule:g,time:I,overtime:b},meta:{name:u,copyright:y,scribe:M,commentator:m,result:f,date:x},rest:n(r,["PB","PW","BR","WR","SZ","KM","RU","GN","CP","US","AN","TM","OT","RE","DT"]),tree:i[0]}}function I(t,i){try{const{branchIndex:e,source:{treeRef:r}}=t[i],s=e===r[0].length-1,a=t[i+1],n=r[1].map((t=>t[0])).map((t=>t[0]));return(s?n:[r[0][e+1]]).filter((t=>!!t)).map(((t,i)=>{const e=a&&(t.B||t.W)===(a.B||a.W);return u(Object.assign(Object.assign({},t),{inPath:e}),i)}))}catch(t){return console.error(t),[]}}const b=t=>({["black"===t.state?"B":"W"]:""+d(t.x)+d(t.y)});function f(t){const i=Array.from(new Set(t.filter((t=>/[A-Z]{1}/i.test(t[1]))).map((t=>t[1].toLowerCase()))));return o(i.length+1).find((t=>!i.includes(t))).toUpperCase()}function x(t){const i=Array.from(new Set(t.filter((t=>/[\d]{1,2}/i.test(t[1]))).map((t=>t[1]))));return(e=i.length+1,Array(e).fill(null).map(((t,i)=>i+1))).find((t=>!i.includes(t)))||1;var e}const j={MINIMAL:"miminal",CONDENSED:"condensed",NORMAL:"normal",FULLSIZE:"fullsize"};const p=class{constructor(e){t(this,e),this.moveAttempt=i(this,"moveAttempt",7),this.options={order:!1,zoom:100,style:{texture:!1}},this.size=19,this.state=[],this.overlay=[],this.ghosts=[],this.target=null,this.width=700,this.padding=40,this.innerGridSize=this.width-this.padding,this.outerPath=`M 0, 0 H ${this.width} V ${this.width} H 0 V 0`,this.innerPath=`M ${this.padding}, ${this.padding} H ${this.innerGridSize} V ${this.innerGridSize} H ${this.padding} V ${this.padding}`,this.getLineSpace=(t,i,e)=>(t-2*e)/(i-1),this.lineSpace=this.getLineSpace(this.width,this.size,this.padding),this.lines=this.getLines(),this.coordMarkers=this.getCoordMarkers(),this.getPos=t=>Math.round(this.padding+t*this.lineSpace-this.lineSpace/2)}onSizeChange(t){console.log({newSize:t}),this.lineSpace=this.getLineSpace(this.width,this.size,this.padding),this.lines=this.getLines(),this.coordMarkers=this.getCoordMarkers()}handleOver(t){this.target=this.getPosFromCoord(t.x,t.y);const i=this.el.querySelector(".target"),e=i.getAttribute("x"),r=i.getAttribute("y"),s=this.getPos(this.target.x).toString(),a=this.getPos(this.target.y).toString();var n,o,c;e==s&&r==a||(o={x:e,y:r},(n=i).setAttribute("x",(c={x:s,y:a}).x),n.setAttribute("y",c.y),n.animate([{x:o.x,y:o.y},{x:c.x,y:c.y}],{duration:200,iterations:1,fill:"forwards"}))}handleLeave(){this.target=null}sendMove(){this.moveAttempt.emit(this.target)}getPosFromCoord(t,i){const{width:e,top:r,left:s}=this.el.querySelector(".woodboard").getClientRects()[0],a=t=>this.width/e*t,n=t=>Math.ceil((a(t)-this.padding-this.lineSpace/2)/this.lineSpace);return{x:n(t+-s),y:n(i+-r)}}render(){var t;const i=(this.state||[]).map((({order:t,state:i,x:e,y:r},s)=>({order:t+1,index:s,color:i,xt:this.getPos(e)+this.lineSpace/2,yt:this.getPos(r)+this.lineSpace/2,x:this.getPos(e),y:this.getPos(r)}))),r=[...i].sort(((t,i)=>i.order-t.order))[0],s=this.ghosts.map((({state:t,x:i,y:e,inPath:r},s)=>({color:t,order:d(s),inPath:r,xt:this.getPos(i)+this.lineSpace/2,yt:this.getPos(e)+this.lineSpace/2,x:this.getPos(i),y:this.getPos(e)}))),a=(this.overlay||[]).map((t=>{var{x:i,y:e}=t,r=function(t,i){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&i.indexOf(r)<0&&(e[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(t);s<r.length;s++)i.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(e[r[s]]=t[r[s]])}return e}(t,["x","y"]);return Object.assign(Object.assign({},r),{xt:this.getPos(i)+this.lineSpace/2,yt:this.getPos(e)+this.lineSpace/2,x:this.getPos(i),y:this.getPos(e)})})),n=this.target?{x:this.getPos(this.target.x),y:this.getPos(this.target.y)}:{x:0,y:0},o=100/this.options.zoom,c=()=>(this.width-this.width*o)/2,l={x:1!=o?c():0,y:1!=o?c():0},g=this.width-this.width*o,u=1!=o&&n?{x:h(0,n.x-this.width/2,g),y:h(0,n.y-this.width/2,g)}:l,y=function(t){const i=h(1,Math.round(t/3)-1,3),e=t-i-1;let r=[];if(t%2){const s=(t+t%2)/2-1;r=[{x:s,y:s},{x:s,y:i},{x:i,y:s},{x:s,y:e},{x:e,y:s}]}return[...r,{x:i,y:i},{x:e,y:i},{x:i,y:e},{x:e,y:e}]}(this.size).map((({x:t,y:i})=>({x:this.getPos(t),y:this.getPos(i)}))),M=[this.innerPath,...this.lines].join(" ");return e("svg",{class:"svgboard",onMouseLeave:()=>this.handleLeave(),onMouseMove:t=>this.handleOver(t),viewBox:`${u.x} ${u.x} ${this.width*o} ${this.width*o}`},e("defs",null,e("filter",{id:"wood_texture",x:"-20%",y:"-20%",width:"140%",height:"140%",filterUnits:"objectBoundingBox",primitiveUnits:"userSpaceOnUse","color-interpolation-filters":"s-rGB"},e("feTurbulence",{type:"fractalNoise",baseFrequency:"0.05 0.05",numOctaves:"5",seed:"1",stitchTiles:"stitch",result:"turbulence"}),e("feDiffuseLighting",{surfaceScale:"1",diffuseConstant:"4","lighting-color":"rgb(223, 178, 96)",in:"turbulence",result:"diffuseLighting"},e("feDistantLight",{azimuth:"100",elevation:"17"})),e("feComposite",{in:"diffuseLighting",in2:"SourceAlpha",operator:"in",result:"composite"}),e("feMorphology",{operator:"erode",radius:"1 15",x:"0%",y:"0%",width:"100%",height:"100%",in:"composite",result:"morphology"})),e("filter",{id:"MyFilter",filterUnits:"objectBoundingBox",x:"0",y:"0",width:"100%",height:"100%"},e("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"2",result:"blur"}),e("feOffset",{in:"blur",dx:"1",dy:"2",result:"offsetBlur"}),e("feSpecularLighting",{in:"blur",surfaceScale:"3",specularConstant:".3",specularExponent:"20","lighting-color":"#666666",result:"specOut"},e("fePointLight",{x:"-50000",y:"-100000",z:"200000"})),e("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),e("feComposite",{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0",result:"litPaint"}),e("feMerge",null,e("feMergeNode",{in:"offsetBlur"}),e("feMergeNode",{in:"litPaint"}))),e("radialGradient",{id:"stone_grad_black",cx:"0.5",cy:"0.5",r:"0.5",fx:"0.25",fy:"0.25"},e("stop",{offset:"0%","stop-color":"#aaa"}),e("stop",{offset:"100%","stop-color":"rgb(25, 25, 40)"})),e("radialGradient",{id:"stone_grad_white",cx:"0.5",cy:"0.5",r:"0.5",fx:"0.25",fy:"0.25"},e("stop",{offset:"0%","stop-color":"#ffffff"}),e("stop",{offset:"100%","stop-color":"#aaaaaa"}))),e("symbol",{id:"target",width:this.lineSpace,height:this.lineSpace,viewBox:"0 0 2 2"},e("circle",{cx:"1",cy:"1",r:"0.5",fill:"rgba(0,0,0,.3)"})),e("symbol",{id:"hoshi",width:this.lineSpace,height:this.lineSpace,viewBox:"0 0 2 2"},e("circle",{cx:"1",cy:"1",r:"0.1",fill:"rgba(0,0,0,.8)"})),e("symbol",{id:"last",width:this.lineSpace,height:this.lineSpace,viewBox:"0 0 2 2"},e("circle",{cx:"1",cy:"1",r:"0.4",fill:"rgba(250,150,150,.8)"})),this.renderStoneSymbol(this.lineSpace,"black"),this.renderStoneSymbol(this.lineSpace,"white"),a.length&&this.renderMarkersSymbol(this.lineSpace),e("path",{class:"woodboard","data-textured":null===(t=this.options.style)||void 0===t?void 0:t.texture,d:this.outerPath}),e("path",{class:"lines",d:M}),y.map((({x:t,y:i})=>e("use",{xlinkHref:"#hoshi",x:t,y:i}))),e("g",{class:"coords"},this.coordMarkers.map((({m:t,x:i,y:r})=>e("text",{x:i,y:r},t)))),e("g",{class:"stones",filter:"url(#MyFilter)"},e("path",{fill:"transparent",d:this.outerPath}),i.map((t=>this.renderStone(t)))),s.map(((t,i,e)=>this.renderGhost(t,e.length>1))),r&&e("use",{xlinkHref:"#last",x:r.x,y:r.y}),e("g",{class:"markers"},e("path",{fill:"transparent",d:this.outerPath}),a.map((({state:t,label:i,boardState:r,x:s,y:a,xt:n,yt:o})=>e("g",null,t&&e("use",{xlinkHref:`#marker_${t}_on${r}`,x:s,y:a}),i&&"empty"===r&&e("use",{xlinkHref:`#marker_label_on${r}`,x:s,y:a}),i&&e("text",{class:`on${r}`,x:n,y:o},i))))),e("use",{onClick:()=>this.sendMove(),class:"target",xlinkHref:"#target",x:n.x,y:n.y}))}getLines(){const t=Array(this.size-2).fill("").map(((t,i)=>`M ${this.padding}, ${(i+1)*this.lineSpace+this.padding} H ${this.innerGridSize}`));return[...Array(this.size-2).fill("").map(((t,i)=>`M ${(i+1)*this.lineSpace+this.padding}, ${this.padding} V ${this.innerGridSize}`)),...t]}getCoordMarkers(){const t=Array(this.size).fill("").map(((t,i)=>i)),i=t.map((t=>({x:t*this.lineSpace+this.padding,y:this.padding/2,m:d(t<8?t:t+1).toUpperCase()}))),e=i.map((t=>Object.assign(Object.assign({},t),{y:this.width-this.padding/2}))),r=t.map((t=>({y:t*this.lineSpace+this.padding,x:this.padding/2,m:this.size-t}))),s=r.map((t=>Object.assign(Object.assign({},t),{x:this.width-this.padding/2})));return[].concat(i,e,r,s)}renderStoneSymbol(t,i){return e("symbol",{id:`stone_${i}`,width:t,height:t,viewBox:"0 0 2 2"},e("circle",{class:`stone ${i}`,cx:"1",cy:"1",r:"0.9",fill:`url(#stone_grad_${i})`}))}renderMarkersSymbol(t){return e("g",null,e("symbol",{id:"marker_circle_onempty",width:t,height:t,viewBox:"0 0 20 20"},e("circle",{cx:"10",cy:"10",r:"6",fill:"none",stroke:"#000",opacity:"0.7"})),e("symbol",{id:"marker_triangle_onempty",width:t,height:t,viewBox:"0 0 20 20"},e("polygon",{points:"10,5 5,15 15,15",fill:"transparent",stroke:"#000",opacity:"0.7"})),e("symbol",{id:"marker_square_onempty",width:t,height:t,viewBox:"0 0 20 20"},e("rect",{x:"5",y:"5",width:"10",height:"10",fill:"transparent",stroke:"#000",opacity:"0.7"})),e("symbol",{id:"marker_mark_onempty",width:t,height:t,viewBox:"0 0 20 20"},e("path",{d:"M 5 5 L 15 15 M 5 15 L 15 5",fill:"transparent",stroke:"#000",opacity:"0.7"})),e("symbol",{id:"marker_circle_onblack",width:t,height:t,viewBox:"0 0 20 20"},e("circle",{cx:"10",cy:"10",r:"6",fill:"none",stroke:"#fff",opacity:"0.7"})),e("symbol",{id:"marker_triangle_onblack",width:t,height:t,viewBox:"0 0 20 20"},e("polygon",{points:"10,5 5,15 15,15",fill:"transparent",stroke:"#fff",opacity:"0.7"})),e("symbol",{id:"marker_square_onblack",width:t,height:t,viewBox:"0 0 20 20"},e("rect",{x:"5",y:"5",width:"10",height:"10",fill:"transparent",stroke:"#fff",opacity:"0.7"})),e("symbol",{id:"marker_mark_onblack",width:t,height:t,viewBox:"0 0 20 20"},e("path",{d:"M 5 5 L 15 15 M 5 15 L 15 5",fill:"transparent",stroke:"#fff",opacity:"0.7"})),e("symbol",{id:"marker_circle_onwhite",width:t,height:t,viewBox:"0 0 20 20"},e("circle",{cx:"10",cy:"10",r:"6",fill:"none",stroke:"#000",opacity:"0.7"})),e("symbol",{id:"marker_triangle_onwhite",width:t,height:t,viewBox:"0 0 20 20"},e("polygon",{points:"10,5 5,15 15,15",fill:"transparent",stroke:"#000",opacity:"0.7"})),e("symbol",{id:"marker_square_onwhite",width:t,height:t,viewBox:"0 0 20 20"},e("rect",{x:"5",y:"5",width:"10",height:"10",fill:"transparent",stroke:"#000",opacity:"0.7"})),e("symbol",{id:"marker_mark_onwhite",width:t,height:t,viewBox:"0 0 20 20"},e("path",{d:"M 5 5 L 15 15 M 5 15 L 15 5",fill:"transparent",stroke:"#000",opacity:"0.7"})),e("symbol",{id:"marker_label_onempty",width:t,height:t,viewBox:"0 0 20 20"},e("circle",{class:"woodElement",cx:"10",cy:"10",r:"6"})))}renderStone({color:t,x:i,y:r,xt:s,yt:a,order:n}){const o=Math.max(0,n);return e("g",{class:t},e("use",{xlinkHref:`#stone_${t}`,x:i,y:r}),this.options.order&&o&&e("text",{x:s,y:a},o))}renderGhost({color:t,order:i,x:r,y:s,xt:a,yt:n,inPath:o},c){return e("g",{class:t},e("use",{xlinkHref:`#stone_${t}`,x:r,y:s,opacity:o?"0.7":"0.4"}),c&&e("text",{x:a,y:n},i.toUpperCase()))}get el(){return r(this)}static get watchers(){return{size:["onSizeChange"]}}};p.style=".lines{stroke:var(--gc-line);stroke-width:1;fill:none}.svgboard{display:block;min-width:50px;min-height:50px;width:100%;height:100%;max-height:var(--gcp-max-boardsize, 100vh);max-width:var(--gcp-max-boardsize, 100vh);overflow:hidden}.woodElement,.woodboard{fill:var(--gc-bg-board)}.woodboard[data-textured]{filter:url(#wood_texture)}.coords text{font-family:sans-serif;text-anchor:middle;dominant-baseline:middle;text-align:center;font-size:10px;fill:#000}.markers text,.white text,.black text{font-family:sans-serif;text-anchor:middle;text-align:center;dominant-baseline:middle;font-size:10px}.markers text{font-size:16px}text.onempty,text.onwhite,.white text{fill:#000;stroke:#ffffff88}text.onblack,.black text{fill:#fff;stroke:#00000088}.stones text{font-size:16px}.stones text,.markers text{paint-order:stroke;stroke-width:3px;font-weight:500}";const w=class{constructor(e){t(this,e),this.addComment=i(this,"addComment",7),this.path=[],this.position=0}sendComment(t){t.preventDefault();const i=[...t.target.querySelectorAll("input, textarea, select")].reduce(((t,i)=>(t[i.attributes.name.value]=i.value,t)),{});this.addComment.emit(i),this.commentsList.shadowRoot.querySelector("form").reset()}render(){const t=this.path.sort(((t,i)=>t.order-i.order)).slice(0,this.position).map(((t,i)=>Object.assign(Object.assign({},t),{order:i+1}))),i=t.filter((t=>t.C)),r=t[t.length-1],s=r&&r.C||"";return e("form",{class:"wrapper",onSubmit:t=>this.sendComment(t)},e("div",{class:"comments"},i.map((t=>e("p",null,t.order,":",t.C)))),e("div",{class:"comment-input"},e("textarea",{name:"comment"},s),e("button",null,"send"),e("button",{type:"reset"},"reset")))}get commentsList(){return r(this)}};w.style=":host{font-family:Verdana, Geneva, Tahoma, sans-serif}.wrapper{display:flex;flex-flow:column;height:100%;pointer-events:none}.comments{display:flex;flex-flow:column;align-items:flex-start;flex:1}.comment-input{display:flex;flex-flow:row;border-top:2px solid var(--gc-bg-dark);border-bottom:2px solid var(--gc-bg-light);pointer-events:all}.comment-input textarea{background:var(--gc-bg-dark);border:none;outline:none;flex:1;padding:5px;font-size:inherit;color:#fff}.comment-input button{background:var(--gc-bg-light);border:none;outline:none}@keyframes slideIn{from{opacity:0;transform:translateY(3em);filter:blur(5px)}to{opacity:.7;transform:translateY(0em);filter:blur(0px)}}p{animation:slideIn .5s ease-in-out forwards;display:inline-flex;align-items:center;background:var(--gc-bg-dark);border-radius:var(--gc-radius);padding:.5em;margin:.5em;color:var(--gc-txt-dark);opacity:.5}";const v=[["SQ","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTE4IDRINmMtMS4xIDAtMiAuOS0yIDJ2MTJjMCAxLjEuOSAyIDIgMmgxMmMxLjEgMCAyLS45IDItMlY2YzAtMS4xLS45LTItMi0yem0wIDE0SDZWNmgxMnYxMnoiLz48L3N2Zz4=","Square"],["CR","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTEyIDJDNi40NyAyIDIgNi40NyAyIDEyczQuNDcgMTAgMTAgMTAgMTAtNC40NyAxMC0xMFMxNy41MyAyIDEyIDJ6bTAgMThjLTQuNDEgMC04LTMuNTktOC04czMuNTktOCA4LTggOCAzLjU5IDggOC0zLjU5IDgtOCA4eiIvPjwvc3ZnPg==","Circle"],["MA","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=","Mark"],["TR","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij4KPHBhdGggdHJhbnNmb3JtPSJyb3RhdGUoMTgwLCAxMiwgMTIpIiBkPSJNMyA0bDkgMTYgOS0xNkgzem0zLjM4IDJoMTEuMjVMMTIgMTYgNi4zOCA2eiIvPgo8L3N2Zz4K","Triangle"],["AB","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTUgMTFoLTR2NGgtMnYtNEg3di0yaDRWN2gydjRoNHYyeiIvPjwvc3ZnPg==","Add black"],["AW","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTEzIDdoLTJ2NEg3djJoNHY0aDJ2LTRoNHYtMmgtNFY3em0tMS01QzYuNDggMiAyIDYuNDggMiAxMnM0LjQ4IDEwIDEwIDEwIDEwLTQuNDggMTAtMTBTMTcuNTIgMiAxMiAyem0wIDE4Yy00LjQxIDAtOC0zLjU5LTgtOHMzLjU5LTggOC04IDggMy41OSA4IDgtMy41OSA4LTggOHoiLz48L3N2Zz4K","Add white"],["AE","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTcgMTF2MmgxMHYtMkg3em01LTlDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTAgMThjLTQuNDEgMC04LTMuNTktOC04czMuNTktOCA4LTggOCAzLjU5IDggOC0zLjU5IDgtOCA4eiIvPjwvc3ZnPg==","Add empty"],["LB_ALPHA","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDBWMHptMCAwaDI0djI0SDBWMHptLjc1Ljc1aDIyLjV2MjIuNUguNzV6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTE0Ljk0IDQuNjZoLTQuNzJsMi4zNi0yLjM2em0tNC42OSAxNC43MWg0LjY2bC0yLjMzIDIuMzN6TTYuMSA2LjI3TDEuNiAxNy43M2gxLjg0bC45Mi0yLjQ1aDUuMTFsLjkyIDIuNDVoMS44NEw3Ljc0IDYuMjdINi4xem0tMS4xMyA3LjM3bDEuOTQtNS4xOCAxLjk0IDUuMThINC45N3ptMTAuNzYgMi41aDYuMTJ2MS41OWgtOC41M3YtMS4yOWw1LjkyLTguNTZoLTUuODh2LTEuNmg4LjN2MS4yNmwtNS45MyA4LjZ6Ii8+PC9zdmc+","Add alphabetic label "],["LB_NUMERIC","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTE3LjYzIDUuODRDMTcuMjcgNS4zMyAxNi42NyA1IDE2IDVMNSA1LjAxQzMuOSA1LjAxIDMgNS45IDMgN3YxMGMwIDEuMS45IDEuOTkgMiAxLjk5TDE2IDE5Yy42NyAwIDEuMjctLjMzIDEuNjMtLjg0TDIyIDEybC00LjM3LTYuMTZ6Ii8+PC9zdmc+","Add number label "]],A=({color:t,name:i,level:r,score:s,isTurn:a})=>e("div",{title:`${i} (${r||"-"})`,"data-player":t,"data-isturn":t===a},e("span",{class:"stone"},e("span",{class:"captured"},s)),e("span",{class:"name"},`${i} (${r||"-"})`)),D=({icon:t,onAction:i,marker:r,title:s,selected:a})=>e("button",{"data-enabled":a,title:s,type:"button",onClick:()=>i(r)},e("img",{src:t,alt:s,title:s})),N=class{constructor(e){t(this,e),this.selectPosition=i(this,"selectPosition",7),this.download=i(this,"download",7),this.optionChange=i(this,"optionChange",7),this.history=[],this.data={},this.variations={},this.position=0,this.options={},this.score={}}next(){this.selectPosition.emit({order:this.position+1})}prev(){this.selectPosition.emit({order:this.position-1})}first(){this.selectPosition.emit({order:0})}last(){this.selectPosition.emit({order:this.history.length})}toggleNumber(){this.optionChange.emit({order:!this.options.order})}toggleTree(){this.optionChange.emit({tree:!this.options.tree})}toggleComments(){this.optionChange.emit({comments:!this.options.comments})}playPause(){this.optionChange.emit({play:!this.options.play})}changeInterval(t){this.optionChange.emit({interval:parseInt(t.target.value,10)})}changeMode(t){this.optionChange.emit({mode:t})}toggleMenu(){this.optionChange.emit({menu:!this.options.menu})}getSGF(){this.download.emit({type:"sgf"})}selectMarker(t){this.optionChange.emit({marker:t})}toggleInfos(){this.optionChange.emit({infos:!!this.options.infos})}render(){const t=this.data.players[this.position%this.data.players.length].color,i=this.data.players.map((t=>Object.assign(Object.assign({},t),{score:this.score.get(t.color)}))),r=this.options.style===j.CONDENSED,s="SETTINGS"===this.options.mode,a="READ"===this.options.mode,n="EDIT"===this.options.mode;return e("section",{class:this.options.style},e("header",null,i.map((i=>e(A,Object.assign({},i,{isTurn:t})))),r&&e("button",{type:"button",onClick:()=>this.toggleMenu()},e("img",{src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTYgMTBjLTEuMSAwLTIgLjktMiAycy45IDIgMiAyIDItLjkgMi0yLS45LTItMi0yem0xMiAwYy0xLjEgMC0yIC45LTIgMnMuOSAyIDIgMiAyLS45IDItMi0uOS0yLTItMnptLTYgMGMtMS4xIDAtMiAuOS0yIDJzLjkgMiAyIDIgMi0uOSAyLTItLjktMi0yLTJ6Ii8+PC9zdmc+"}))),e("div",{class:"menu","data-hidden":!this.options.menu},this.renderModeBar(),s&&this.renderSettingsBar(),a&&this.renderReadBar(),n&&this.renderEditBar()))}renderEditBar(){return e("nav",null,v.map((([t,i,r])=>e(D,{title:r,icon:i,selected:t===this.options.marker,onAction:t=>this.selectMarker(t),marker:t}))))}renderModeBar(){const t=this.options.menu?0:-1;return e("nav",{class:"tablist"},e(C,{tabIndex:t,"data-enabled":"READ"===this.options.mode,onClick:()=>this.changeMode("READ"),icon:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTEyIDQuNUM3IDQuNSAyLjczIDcuNjEgMSAxMmMxLjczIDQuMzkgNiA3LjUgMTEgNy41czkuMjctMy4xMSAxMS03LjVjLTEuNzMtNC4zOS02LTcuNS0xMS03LjV6TTEyIDE3Yy0yLjc2IDAtNS0yLjI0LTUtNXMyLjI0LTUgNS01IDUgMi4yNCA1IDUtMi4yNCA1LTUgNXptMC04Yy0xLjY2IDAtMyAxLjM0LTMgM3MxLjM0IDMgMyAzIDMtMS4zNCAzLTMtMS4zNC0zLTMtM3oiLz48L3N2Zz4="}),e(C,{tabIndex:t,"data-enabled":"EDIT"===this.options.mode,onClick:()=>this.changeMode("EDIT"),icon:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMyAxNy4yNVYyMWgzLjc1TDE3LjgxIDkuOTRsLTMuNzUtMy43NUwzIDE3LjI1ek0yMC43MSA3LjA0Yy4zOS0uMzkuMzktMS4wMiAwLTEuNDFsLTIuMzQtMi4zNGMtLjM5LS4zOS0xLjAyLS4zOS0xLjQxIDBsLTEuODMgMS44MyAzLjc1IDMuNzUgMS44My0xLjgzeiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4="}),e(C,{tabIndex:t,"data-enabled":"SETTINGS"===this.options.mode,onClick:()=>this.changeMode("SETTINGS"),icon:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCI+PGc+PHBhdGggZD0iTTAsMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTE5LjE0LDEyLjk0YzAuMDQtMC4zLDAuMDYtMC42MSwwLjA2LTAuOTRjMC0wLjMyLTAuMDItMC42NC0wLjA3LTAuOTRsMi4wMy0xLjU4YzAuMTgtMC4xNCwwLjIzLTAuNDEsMC4xMi0wLjYxIGwtMS45Mi0zLjMyYy0wLjEyLTAuMjItMC4zNy0wLjI5LTAuNTktMC4yMmwtMi4zOSwwLjk2Yy0wLjUtMC4zOC0xLjAzLTAuNy0xLjYyLTAuOTRMMTQuNCwyLjgxYy0wLjA0LTAuMjQtMC4yNC0wLjQxLTAuNDgtMC40MSBoLTMuODRjLTAuMjQsMC0wLjQzLDAuMTctMC40NywwLjQxTDkuMjUsNS4zNUM4LjY2LDUuNTksOC4xMiw1LjkyLDcuNjMsNi4yOUw1LjI0LDUuMzNjLTAuMjItMC4wOC0wLjQ3LDAtMC41OSwwLjIyTDIuNzQsOC44NyBDMi42Miw5LjA4LDIuNjYsOS4zNCwyLjg2LDkuNDhsMi4wMywxLjU4QzQuODQsMTEuMzYsNC44LDExLjY5LDQuOCwxMnMwLjAyLDAuNjQsMC4wNywwLjk0bC0yLjAzLDEuNTggYy0wLjE4LDAuMTQtMC4yMywwLjQxLTAuMTIsMC42MWwxLjkyLDMuMzJjMC4xMiwwLjIyLDAuMzcsMC4yOSwwLjU5LDAuMjJsMi4zOS0wLjk2YzAuNSwwLjM4LDEuMDMsMC43LDEuNjIsMC45NGwwLjM2LDIuNTQgYzAuMDUsMC4yNCwwLjI0LDAuNDEsMC40OCwwLjQxaDMuODRjMC4yNCwwLDAuNDQtMC4xNywwLjQ3LTAuNDFsMC4zNi0yLjU0YzAuNTktMC4yNCwxLjEzLTAuNTYsMS42Mi0wLjk0bDIuMzksMC45NiBjMC4yMiwwLjA4LDAuNDcsMCwwLjU5LTAuMjJsMS45Mi0zLjMyYzAuMTItMC4yMiwwLjA3LTAuNDctMC4xMi0wLjYxTDE5LjE0LDEyLjk0eiBNMTIsMTUuNmMtMS45OCwwLTMuNi0xLjYyLTMuNi0zLjYgczEuNjItMy42LDMuNi0zLjZzMy42LDEuNjIsMy42LDMuNlMxMy45OCwxNS42LDEyLDE1LjZ6Ii8+PC9nPjwvc3ZnPg=="}))}renderReadBar(){const t=this.options.menu?0:-1;return e("nav",null,e(C,{tabIndex:t,onClick:()=>this.first(),icon:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMTguNDEgMTYuNTlMMTMuODIgMTJsNC41OS00LjU5TDE3IDZsLTYgNiA2IDZ6TTYgNmgydjEySDZ6Ii8+PHBhdGggZD0iTTI0IDI0SDBWMGgyNHYyNHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4K"}),e(C,{tabIndex:t,onClick:()=>this.prev(),icon:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMTUuNDEgNy40MUwxNCA2bC02IDYgNiA2IDEuNDEtMS40MUwxMC44MyAxMnoiLz48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PC9zdmc+"}),e(C,{tabIndex:t,disabled:"READ"!==this.options.mode,"data-enabled":this.options.play,onClick:()=>this.playPause(),icon:this.options.play?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNNiAxOWg0VjVINnYxNHptOC0xNHYxNGg0VjVoLTR6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNOCA1djE0bDExLTd6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjwvc3ZnPg=="}),e(C,{tabIndex:t,onClick:()=>this.next(),icon:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMTAgNkw4LjU5IDcuNDEgMTMuMTcgMTJsLTQuNTggNC41OUwxMCAxOGw2LTZ6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjwvc3ZnPg=="}),e(C,{tabIndex:t,onClick:()=>this.last(),icon:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNNS41OSA3LjQxTDEwLjE4IDEybC00LjU5IDQuNTlMNyAxOGw2LTYtNi02ek0xNiA2aDJ2MTJoLTJ6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PC9zdmc+"}))}renderSettingsBar(){const t=this.options.menu?0:-1;return e("nav",null,e(C,{tabIndex:t,"data-enabled":this.options.order,onClick:()=>this.toggleNumber(),icon:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMiAxN2gydi41SDN2MWgxdi41SDJ2MWgzdi00SDJ2MXptMS05aDFWNEgydjFoMXYzem0tMSAzaDEuOEwyIDEzLjF2LjloM3YtMUgzLjJMNSAxMC45VjEwSDJ2MXptNS02djJoMTRWNUg3em0wIDE0aDE0di0ySDd2MnptMC02aDE0di0ySDd2MnoiLz48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PC9zdmc+"}),e(C,{tabIndex:t,"data-enabled":this.options.tree,onClick:()=>this.toggleTree(),icon:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTIyIDExVjNoLTd2M0g5VjNIMnY4aDdWOGgydjEwaDR2M2g3di04aC03djNoLTJWOGgydjN6Ii8+PC9zdmc+"}),e(C,{tabIndex:t,"data-enabled":this.options.order,onClick:()=>this.toggleInfos(),icon:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTEgMTVoLTJ2LTZoMnY2em0wLThoLTJWN2gydjJ6Ii8+PC9zdmc+"}),e(C,{tabIndex:t,"data-enabled":this.options.comments,onClick:()=>this.toggleComments(),icon:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMjAgMkg0Yy0xLjEgMC0xLjk5LjktMS45OSAyTDIgMjJsNC00aDE0YzEuMSAwIDItLjkgMi0yVjRjMC0xLjEtLjktMi0yLTJ6TTYgOWgxMnYySDZWOXptOCA1SDZ2LTJoOHYyem00LTZINlY2aDEydjJ6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjwvc3ZnPg=="}),e(C,{tabIndex:t,onClick:()=>this.getSGF(),icon:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMTkgOWgtNFYzSDl2Nkg1bDcgNyA3LTd6TTUgMTh2MmgxNHYtMkg1eiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4="}))}},C=t=>{var{icon:i}=t,r=function(t,i){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&i.indexOf(r)<0&&(e[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(t);s<r.length;s++)i.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(e[r[s]]=t[r[s]])}return e}(t,["icon"]);return e("button",Object.assign({type:"button"},r)," ",e("img",{src:i}))};var L,k;N.style='@keyframes slideIn{from{opacity:0;transform:translateY(5em)}to{opacity:1;transform:translateY(0em)}}@keyframes turn{from{box-shadow:inset 0 0 0 0 transparent}to{box-shadow:inset 0px -4em 0 -2px var(--gc-bg-light)}}@keyframes slideInRight{from{opacity:0;transform:translateX(-2em)}to{opacity:1;transform:translateX(0em)}}:host{display:block;font-family:var(--gc-font);max-width:var(--gcp-max-boardsize, 100vh)}.normal :host{position:relative}header{display:flex;position:relative;align-items:center;box-shadow:0 0 1em var(--gc-bg-dark);height:3em;z-index:20}:not(.condensed) header{height:auto;flex-flow:row wrap}header button{height:3em;transition:all ease-in-out .3s;flex:1 0 3em}[data-player]{display:flex;position:relative;align-items:center;justify-content:flex-start;flex-flow:row nowrap;align-self:flex-start;overflow:hidden;text-overflow:ellipsis;background:var(--gc-bg-dark);border-radius:var(--gc-container-radius);color:var(--gc-txt-dark);height:3em;padding:0 .5rem;flex:0 0 2rem;transition:all ease-in-out .3s}:not(.condensed) [data-player],.condensed [data-player] :hover{flex:1 0 200px}nav{color:var(--gc-txt-light);display:flex;flex-flow:row wrap-reverse}nav button{animation:slideInRight .5s -.5s ease-in-out both}.tablist{display:flex;background:var(--gc-bg-dark);flex-flow:column-reverse;overflow:hidden;flex:0 0 48px;transition:.3s ease-in-out all;max-height:100%}:not(.condensed) .tablist{flex-flow:row;overflow:visible;flex:1 0 40px}.condensed .tablist :not([data-enabled]){order:1}.condensed .tablist:not(:focus-within),.condensed .tablist:not(:hover){max-height:40px}.tablist>button{flex:1 0 40px;width:48px}.tablist img{filter:invert(1)}.condensed .menu{position:absolute;left:0;right:0;bottom:3em;height:calc(100% - 3em);background:linear-gradient(0, var(--gc-bg-light), transparent 20%)}.menu{max-width:var(--gcp-max-boardsize, 100vh);pointer-events:none;overflow:auto;background:var(--gc-bg-light);transition:all .5s ease-in-out;display:flex;flex-flow:column;transform:translateY(0)}.condensed .menu{flex-flow:row;align-items:flex-end}.menu[data-hidden]{transform:translateY(100%)}.menu nav>*{pointer-events:auto}.menu:hover,.menu:focus-within{transition:all .3s ease-in-out;opacity:1}[data-player][data-isturn]{animation:turn .5s ease-in-out forwards}[data-player] .captured{display:inline-flex;justify-content:center;align-items:center;width:1.3rem;height:1.3rem;border-radius:100%;font-size:.8em;background:var(--gc-bg-light);color:var(--gc-txt-light);position:relative;top:calc(50% - .65rem);left:50%}[data-player] .stone{content:\'\';display:inline-block;flex-shrink:0;width:2em;height:2em;box-shadow:inset 0 0 5px;border-radius:100%}[data-player] .name{padding:0 1em;white-space:nowrap}[data-player="BLACK"] .stone{background:var(--gc-black-stone-bg);box-shadow:var(--gc-black-stone-shadow)}[data-player="WHITE"] .stone{background:var(--gc-white-stone-bg);box-shadow:var(--gc-white-stone-shadow)}[data-player="BLACK"] .captured{background:var(--gc-white-stone-bg);box-shadow:var(--gc-black-stone-shadow);color:var(--gc-txt-light)}[data-player="WHITE"] .captured{background:var(--gc-black-stone-bg);box-shadow:var(--gc-white-stone-shadow);color:var(--gc-txt-dark)}.condensed [data-player="WHITE"]{flex-flow:row-reverse;order:1}select:focus,button:focus,button:hover{outline:none;box-shadow:inset 0 0 0 2px var(--gc-bg);background:var(--gc-bg-light);transition:.3s ease-in-out all}button[data-enabled]{background:var(--gc-bg)}button img{opacity:.6}button[data-enabled] img{filter:invert(1)}.input-control,button,select{transition:.3s ease-in-out all;border:none;background:transparent;border-radius:var(--container-radius);padding:0 5px;font-size:1rem}.input-control,button{width:2.5em;height:2.5em;display:inline-flex;border-radius:var(--container-radius);align-items:center;justify-content:center;transition:.3s ease-in-out all;box-shadow:inset 0 0 0 0px var(--gc-bg)}button[disabled]{opacity:.3}.input-control.zoom input{width:auto;max-width:3em;background:transparent;border:none}',function(t){t.BLACK="black",t.WHITE="white",t.KO="ko"}(L||(L={})),function(t){t.TRIANGLE="triangle",t.CIRCLE="circle",t.SQUARE="square",t.LABEL="label",t.LINE="line",t.ARROW="arrow",t.MARK="mark",t.DIMMED="dimmed"}(k||(k={}));class T{validate(t,i){let e=[...t.slice()];const r=t=>1===t.captured.length&&!this.liberties(e,t).length;if((i=>!t[i.x][i.y].state)(s=i)&&((e=>{const r=[...t.slice()];return r[i.x][i.y]=i,this.captured(r,e).length})(s)||(t=>this.liberties(e,t).length)(s))&&!(i=>t[i.x][i.y].state===L.KO)(s)){e=this.resetKo(e),e[i.x][i.y]=i;const t=this.captured(e,i).reduce(((t,i)=>t.concat(i)),[]);return e[i.x][i.y].captured=t.slice(),r(i)&&(e[t[0].x][t[0].y].state=L.KO),t.reduce(((t,i)=>(t[i.x][i.y].state=i.state===L.KO?L.KO:null,t)),e)}var s;throw new Error(`${i.x}:${i.y} was not a valid move (${t[i.x][i.y].state})`)}resetKo(t){return t.map((t=>t.map((t=>(t.state=t.state==L.KO?null:t.state,t)))))}adjacent(t,i){const e=t.length-1;return[i.y>0?t[i.x][i.y-1]:null,i.y<e?t[i.x][i.y+1]:null,i.x>0?t[i.x-1][i.y]:null,i.x<e?t[i.x+1][i.y]:null].filter((t=>t))}group(t,i,e=[],r=new Set){return r.add(`${i.x}:${i.y}`),Array.from(new Set([i,...e,...this.adjacent(t,i).filter((t=>!r.has(`${t.x}:${t.y}`)&&t.state===i.state)).map((i=>this.group(t,i,e,r))).reduce(((t,i)=>t.concat(i)),[])]))}sliberties(t,i){return this.adjacent(t,i).filter((t=>!t.state))}liberties(t,i,e){return Array.from(new Set(this.group(t,i).map((i=>this.sliberties(t,i))).reduce(((t,i)=>t.concat(i)),[]).filter((t=>t.x!==i.x||t.y!==i.y)).filter((t=>!e||t.x!==e.x||t.y!==e.y))))}captured(t,i){return this.adjacent(t,i).filter((t=>t.state&&t.state!==i.state)).filter((e=>!this.liberties(t,e,i).length)).map((i=>this.group(t,i)))}}var S=function(t,i){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&i.indexOf(r)<0&&(e[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(t);s<r.length;s++)i.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(e[r[s]]=t[r[s]])}return e};class z{constructor(){}read(t){const i=a.parse(t);return this.format(i)}format(t){const[[i]]=t,[e]=i,{PB:r,PW:s,BR:a,WR:n,SZ:o,KM:c,RU:d,GN:h,CP:l,US:g,AN:u,TM:y,OT:M,RE:m,DT:I}=e;return{players:[{color:"black",name:r,level:a},{color:"white",name:s,level:n}],info:{size:o,komi:c,rule:d,time:y,overtime:M},meta:{name:h,copyright:l,scribe:g,commentator:u,result:m,date:I},rest:S(e,["PB","PW","BR","WR","SZ","KM","RU","GN","CP","US","AN","TM","OT","RE","DT"]),tree:t[0]}}}class B{constructor(){this.board=[],this.overlay=[],this.ruleService=new T,this.kifuService=new z,this.history=[],this.createPoint=(t,i,e=null)=>({state:e,order:0}),this.line=t=>Array(t).fill(""),this.at=(t,i)=>this.board[t][i],this.atOverlay=(t,i)=>this.overlay[t][i],this.fromSGFCoord=t=>{const[i,e]=t.split("");return{x:this.a2n(i),y:this.a2n(e)}},this.alphabet=(t=26)=>new Array(t).fill(1).map(((t,i)=>String.fromCharCode(97+i))),this.a2n=t=>this.alphabet().indexOf(t),this.n2a=t=>this.alphabet()[t]}init(t){return this.history=[],this.board=this.initBoard(t),this.overlay=this.initBoard(t),this}initBoard(t){return this.line(t).map((()=>this.line(t))).map(((t,i)=>t.map(((t,e)=>this.createPoint(i,e)))))}play(t){const{x:i,y:e,order:r=this.history.length}=t,s=r%2?L.WHITE:L.BLACK,a=Object.assign(Object.assign({},t),{state:t.state?t.state:s,order:r,x:i,y:e}),n=this.ruleService.validate(this.board,a);return n&&(this.board=n,this.history=[...this.history,Object.assign({},n[i][e])]),this}set(t){const{LB:i=[],AB:e=[],AW:r=[],AE:s=[],TR:a=[],CR:n=[],SQ:o=[],MA:c=[],AR:d=[],LN:h=[],DD:l=[]}=t;this.overlay=this.initBoard(this.overlay.length);const g=t=>i=>e=>{const{x:r,y:s}=this.fromSGFCoord(e);t[r][s].state!==i&&(t[r][s]={x:r,y:s,state:i,order:-1})};this.validateMoveStructure(t);const u=g(this.board);e.forEach(u(L.BLACK)),r.forEach(u(L.WHITE)),s.forEach(u(null));const y=g(this.overlay);c.forEach(y(k.MARK)),h.forEach(y(k.LINE)),d.forEach(y(k.ARROW)),a.forEach(y(k.TRIANGLE)),n.forEach(y(k.CIRCLE)),o.forEach(y(k.SQUARE)),l.forEach(y(k.DIMMED)),i.forEach((t=>{const[i,e]=t,{x:r,y:s}=this.fromSGFCoord(i);this.overlay[r][s]={x:r,y:s,label:e}}));const M=t.W||t.B;if(M){const i=Object.assign(Object.assign(Object.assign({},t),this.fromSGFCoord(M)),{state:t.W?L.WHITE:L.BLACK}),e=this.at(i.x,i.y);this.board[i.x][i.y]=this.createPoint(i.x,i.y);try{this.play(i)}catch(t){this.board[i.x][i.y]=e}}return this}validateMoveStructure(t){const{W:i,B:e,AB:r=[],AW:s=[],AE:a=[]}=t;if(i&&e)throw Error("Both Color cant play on the same move");const n=[...r,...s,...a],o=Array.from(new Set(n));if(o.length!=n.length)throw console.log({additions:n,uniqueAdditions:o}),Error(`Non unique addition detected, check AB, AW and AE properties: \n       ${JSON.stringify(t)}`)}libertiesAt(t,i){const e=this.at(t,i);return e?this.ruleService.liberties(this.board,e).length:0}show(){console.log(this.board.map((t=>t.map((t=>t.state?t.state:"")))))}}const O=["AE","AB","AW"],E=["CR","SQ","TR","MA"],P=class{constructor(i){t(this,i),this.bs=new B,this.rule=new T,this.sgf=null,this.currentPosition=0,this.variations=[0],this.options={play:!1,showOrder:!1,interval:1,mode:"READ",zoom:100,comments:!1,controls:!1,tree:!1,style:{texture:!1}},this.party=m(this.sgf),this.currentPath=g(this.party.tree,this.variations),this.board=this.getGameState(),this.displayControls=!1}onSgfChange(){this.currentPosition=0,this.party=m(this.sgf),this.currentPath=g(this.party.tree,this.variations),this.board=this.getGameState()}handlePosition(t){this.updatePosition(t.detail)}handleOptionChange(t){this.updateOptions(t.detail)}handleMove(t){try{const e={x:h(0,t.detail.x,this.party.info.size-1),y:h(0,t.detail.y,this.party.info.size-1),state:(i=this.currentPosition,i%2?"white":"black")};switch(this.options.mode){case"EDIT":this.editCurrent(e);break;case"PLAY":case"READ":this.rule.validate(this.board.board,e),this.updateTree(e)}}catch(t){console.error(t)}var i}updateTree(t){const i=I(this.currentPath,this.currentPosition),e=i.findIndex((i=>{return r=t,(e=i)&&r&&e.x===r.x&&e.y===r.y;var e,r})),{branchIndex:r,source:{treeRef:s,level:a}}=this.currentPath[this.currentPosition];if(-1===e){const e=[[b(t)],[]];if(i.length){const t=s[0].slice(0,r+1),i=s[0].slice(r+1);s[0]=t,s[1]=[[i,[...s[1]]],e]}else s[0]=[...s[0],b(t)]}const n=[...this.variations.slice(0,a),e<0?s[1].length-1:e];this.updatePosition({order:this.currentPosition+1,variation:n})}editCurrent({x:t,y:i}){const{branchIndex:e,source:{treeRef:r}}=this.currentPath[this.currentPosition],s=r[0][e],a=this.options.marker,n=d(t)+d(i);let o;switch(!0){case O.includes(a):o=this.setStone({current:s,type:a,coord:n});break;case"LB_ALPHA"===a:o=this.setLabel({type:"LB",current:s,coord:n,generator:f});break;case"LB_NUMERIC"===a:o=this.setLabel({type:"LB",current:s,coord:n,generator:x});break;case E.includes(a):o=this.setMarker({current:s,type:a,coord:n});default:this.updateOptions({mode:"PLAY"})}r[0][e]=Object.assign(Object.assign({},s),o),this.updatePosition({order:this.currentPosition})}setMarker({type:t,current:i,coord:e}){const r=i[t]||[],s=t=>t!==e,a=r.filter(s);if(a.length<r.length)return{[t]:a};const n=E.reduce(((t,e)=>Object.assign(Object.assign({},t),{[e]:(i[e]||[]).filter(s)})),{});return Object.assign(Object.assign({},n),{[t]:[...n[t]||[],e]})}setStone({current:t,type:i,coord:e}){const r=t=>t!==e,s=t[i]||[],a=s.filter(r);if(a.length<s.length)return{[i]:a};const n=O.reduce(((i,e)=>Object.assign(Object.assign({},i),{[e]:(t[e]||[]).filter(r)})),{});return Object.assign(Object.assign({},n),{[i]:[...n[i]||[],e]})}setLabel({type:t,current:i,coord:e,generator:r}){const s=i[t]||[],a=s.filter((([t])=>t!==e));if(a.length<s.length)return{[t]:a};const n=[e,r(s)];return{[t]:[...s,n]}}updateOptions(t){this.options=Object.assign(Object.assign({},this.options),t)}dowloadGame(){!function(t){const i=a.stringify([t.tree]),e=new Blob([i],{type:"application/x-go-sgf"}),r=window.URL.createObjectURL(e),s=document.createElement("a");s.style.display="none",s.href=r,s.setAttribute("download",t.title||"game.sgf"),void 0===s.download&&s.setAttribute("target","_blank"),document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout((()=>{window.URL.revokeObjectURL(r)}),100)}(this.party)}keydownComponent(t){this.options.allowWindowsEvent||this.handleKeydown(t)}keydownWindow(t){this.options.allowWindowsEvent&&this.handleKeydown(t)}handleKeydown(t){if(!(t=>["textarea","input"].includes(t.path[0].type))(t))switch(t.key){case"ArrowDown":case"ArrowUp":this.changeNextFork("ArrowUp"==t.key?-1:1);break;case"ArrowLeft":case"ArrowRight":this.updatePosition({order:this.currentPosition+("ArrowLeft"==t.key?-1:1)*(t.shiftKey?10:1)});break;case"o":case"O":this.updateOptions({order:!this.options.order});break;case"t":case"T":this.updateOptions({tree:!this.options.tree});break;case"n":case"N":this.updateOptions({controls:!this.options.controls});break;case"c":case"C":this.updateOptions({comments:!this.options.comments});break;case"e":case"E":this.updateOptions({mode:"EDIT"});break;case"p":case"P":this.updateOptions({mode:"PLAY"});break;case"r":case"R":this.updateOptions({mode:"READ"});break;case" ":this.updateOptions({play:!this.options.play});break;case"+":this.updateOptions({zoom:h(10,this.options.zoom+1,200)});break;case"-":this.updateOptions({zoom:h(10,this.options.zoom-1,200)});break;case"=":this.updateOptions({zoom:100})}}addComment(t){const{branchIndex:i,source:{treeRef:e}}=this.currentPath[this.currentPosition-1];e[0][i].C=t.detail.comment,this.updatePosition({order:this.currentPosition})}handleScroll(t){t.ctrlKey&&this.updateOptions({zoom:h(10,this.options.zoom-Math.sign(t.deltaY),200)})}handleResize(){this.updateLayout()}componentDidRender(){this.updateLayout()}componentDidUpdate(){this.handleAutoPlay(this.options)}updateLayout(){const t=(t=>{const{width:i}=t.getBoundingClientRect();switch(!0){case i<300:return j.MINIMAL;case i<600:return j.CONDENSED;case i<900:return j.NORMAL;default:return j.FULLSIZE}})(this.el);this.options.style!==t&&(this.updateOptions({style:t,comments:[j.FULLSIZE,j.NORMAL].includes(t),menu:[j.FULLSIZE,j.NORMAL].includes(t)}),this.displayControls=(()=>[j.CONDENSED,j.FULLSIZE,j.NORMAL].includes(this.options.style))())}render(){const t=Object.assign(Object.assign(Object.assign({},this.party.meta),this.party.info),{players:this.party.players}),i=y(this.board.overlay).map((t=>Object.assign(Object.assign({},t),{boardState:this.bs.at(t.x,t.y).state||"empty"}))),r=(this.board.history||[]).reduce(((t,{state:i,captured:e=[]})=>{const r=i.toUpperCase();return t.set(r,(t.has(r)?t.get(r):0)+e.length),new Map(t)}),new Map);return e("div",{class:`goban ${this.options.style}`,tabindex:"0"},e("img",{class:"focus-indicator",src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0Ij48cGF0aCBkPSJNMjAgNUg0Yy0xLjEgMC0xLjk5LjktMS45OSAyTDIgMTdjMCAxLjEuOSAyIDIgMmgxNmMxLjEgMCAyLS45IDItMlY3YzAtMS4xLS45LTItMi0yem0tOSAzaDJ2MmgtMlY4em0wIDNoMnYyaC0ydi0yek04IDhoMnYySDhWOHptMCAzaDJ2Mkg4di0yem0tMSAySDV2LTJoMnYyem0wLTNINVY4aDJ2MnptOSA3SDh2LTJoOHYyem0wLTRoLTJ2LTJoMnYyem0wLTNoLTJWOGgydjJ6bTMgM2gtMnYtMmgydjJ6bTAtM2gtMlY4aDJ2MnoiLz48cGF0aCBkPSJNMCAwaDI0djI0SDB6bTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjwvc3ZnPg=="}),e("gc-board",{class:"goboard",options:this.options,size:this.party.info.size,state:y(this.board.board),overlay:i,ghosts:I(this.currentPath,this.currentPosition)}),this.displayControls&&e("gc-controls",{class:"controls",data:t,score:r,options:this.options,variations:this.variations,history:this.currentPath,position:this.currentPosition}),this.options.comments&&e("gc-comments",{class:"comments",position:this.currentPosition,path:this.currentPath}),this.options.tree&&e("gc-tree",{class:"tree",variations:this.variations,tree:this.party.tree,current:this.currentPath,position:this.currentPosition}))}autoPlay(t){return window.setInterval((()=>{"READ"===this.options.mode&&this.updatePosition({order:this.currentPosition+1})}),1e3*t)}clearAutoPlay(){window.clearInterval(this.timer),this.timer=null}disconnectedCallback(){this.clearAutoPlay()}handleAutoPlay({interval:t,play:i}){i&&!this.timer?this.timer=this.autoPlay(t):this.timer&&!i&&this.clearAutoPlay()}updatePosition({order:t,variation:i=[]}){i.length&&!M(this.variations,i)&&(this.variations=i),this.currentPath=g(this.party.tree,this.variations),this.currentPosition=h(0,t,this.currentPath.length-1),this.board=this.getGameState()}getGameState(){return this.currentPath.slice(0,this.currentPosition+1).reduce(((t,i)=>t.set(i)),this.bs.init(this.party.info.size))}changeNextFork(t){const i=this.currentPath[this.currentPosition].source,{source:e}=this.currentPath.find((t=>t.source.level==i.level+1))||{};if(e){const r=h(0,(this.variations[e.level-1]||e.level)+t,i.variations-1),s=[...this.variations.slice(0,e.level-1),r];this.variations=s,this.currentPath=g(this.party.tree,this.variations)}}get el(){return r(this)}static get watchers(){return{sgf:["onSgfChange"]}}};P.style=".goban{display:flex;flex-flow:column;overflow:hidden;position:relative;background:var(--gc-bg);transition:.3s ease-in-out all}.focus-indicator{position:absolute;top:0px;left:0px;width:2em;height:2em;pointer-events:none;opacity:0;transition:.3s ease-in-out all;transform:translateY(-3em);color:var(--gc-bg);border-left:5px solid;border-top:5px solid}.goban:focus-within .focus-indicator{opacity:1;transform:translateY(0)}.goban.condensed{--gcp-max-boardsize:calc(100vh - 3em)}.goban.normal,.goban.fullsize{--gcp-max-boardsize:100vh;display:grid;grid-template-areas:'board controls'\n  'board comments'\n  'board tree';grid-template-columns:minmax(max-content, var(--gcp-max-boardsize, 100vh)) minmax(250px, 1fr);grid-template-rows:auto 1fr auto}.goboard{grid-area:board;max-height:var(--gcp-max-boardsize, 100vh);max-width:var(--gcp-max-boardsize, 100vh);overflow-x:auto;height:100%}@keyframes slideIn{from{opacity:0;transform:translateY(-10em);filter:blur(5px)}to{opacity:1;transform:translateY(0em)}}@keyframes slideInBottom{from{opacity:0;transform:translateY(10em);filter:blur(5px)}to{opacity:1;transform:translateY(0em)}}.tree{grid-area:tree;width:100%;max-height:40vh;height:100%;max-width:var(--gcp-max-boardsize, 100vh);background:var(--gc-bg-dark);animation:slideInBottom .5s ease-in-out forwards}.condensed .tree{position:absolute;height:calc(100% - 3em);background:linear-gradient(var(--gc-bg-80) 50%, transparent);animation:slideIn .5s ease-in-out forwards;pointer-events:none}.controls{z-index:5;grid-area:controls}:not(.condensed) .controls{position:relative}:not(.condensed) .comments{position:relative;z-index:0;height:100%}.comments{position:absolute;width:100%;height:calc(100% - 3em);max-width:var(--gcp-max-boardsize, 100vh);pointer-events:none}";const G=class{constructor(e){t(this,e),this.selectPosition=i(this,"selectPosition",7),this.selectVariation=i(this,"selectVariation",7),this.variations=[],this.current=[],this.tree=[],this.position=0}select(t,i){this.selectPosition.emit({order:t,variation:i})}isCurrent(t,i){return this.isInPath(i)&&t.order==this.position}isInPath(t=[]){return M(this.variations,t)}showBranch(t,i=0,r=[]){const[s,a=[]]=t;return e("div",{class:"tree-view"},e("div",{class:"stones-wrapper"},Array.isArray(s)?s.map(((t,e)=>this.showStone(t,e+i,r))):this.showStone(s,i,r)),e("div",null,a.map(((t,e)=>this.showBranch(t,i+s.length,[...r,e])))))}showStone(t,i,r){const s=u(t,i);return e("button",{type:"button",class:"stone",onClick:()=>this.select(s.order||0,r),"data-in-path":this.isInPath(r),"data-is-current":this.isCurrent(s,r),"data-color":s.state},s.order)}render(){return e("div",null,e("div",{class:"tree-view"},this.showBranch(this.tree)))}};G.style=':host{display:block;min-height:5em}.tree-view{display:flex;border-radius:var(--container-radius);padding:.5em;width:auto;overflow:auto}.tree-view .tree-view{padding:0;margin:0;position:relative;overflow:visible}.stones-wrapper{display:flex;position:relative}.stones-wrapper:before{content:"";display:block;height:2px;background:linear-gradient(-90deg, transparent, black);position:absolute;top:calc(1.5em - 2px);width:calc(100% - 1em);transform:translateX(2em)}.tree-view+.tree-view:before{z-index:0;content:"";display:block;position:absolute;height:2px;background:linear-gradient(90deg, transparent, black);width:4.5em;transform-origin:top left;transform:rotate(45deg) translate(-2em, 0)}.stone[data-shared]{opacity:.1}.stone{pointer-events:all;flex-shrink:0;display:flex;width:3em;height:3em;margin:.5em;align-items:center;justify-content:center;border-radius:100%;border:none;background:var(--gc-empty-stone-bg);border:2px solid currentColor;color:var(--gc-empty-stone-txt);transition:.3s ease-in-out;transform:scale(.9);z-index:5}.stone[data-color="black"]{border:none;background:var(--gc-black-stone-bg);box-shadow:var(--gc-black-stone-shadow)}.stone[data-color="white"]{border:none;background:var(--gc-white-stone-bg);box-shadow:var(--gc-white-stone-shadow);color:var(--gc-white-stone-txt)}.stone:focus{outline:none}.stone:hover{transform:translateY(-2px) scale(.9)}.stone:active{transform:scale(.9)}.stone[data-is-current]{font-weight:700;transform:scale(1.1);outline:2px solid var(--gc-bg-light)}.variations{display:flex;flex-flow:column;max-height:3em;overflow:hidden}.stone:not([data-in-path]){transform:scale(.6)}';export{p as gc_board,w as gc_comments,N as gc_controls,P as gc_goban,G as gc_tree}